# TCP 拥塞控制

拥塞控制的目的是避免 `[发送方]` 的数据填满整个网络.

为了在 `[发送方]` 调节所要发送数据的量, 定义了一个叫做 `[拥塞窗口]` 的概念.

**拥塞窗口 cwnd** 是发送方维护的一个状态变量, 它会根据**网络的拥塞程度动态变化的**.

在流量控制时提到了发送窗口 `swnd` 和接收窗口 `rwnd` 是约等于的关系, 那么由于加入了拥塞窗口的概念后, 此时发送窗口的
值是 swnd = min(rwnd, cwnd), 也就是拥塞窗口和接收窗口中的最小值.

拥塞窗口 cwnd 变化的规则:

- 只要网络中没有出现拥塞, cwnd 就会增大;
- 网络中出现了拥塞, cwnd 就减少;

> 如何确定当前的网络出现了拥塞?

只要 `发送方` 没有在规定时间内接收到 ACK 应答报文, 也就是**发生了超时重传, 就会认为网络出现了拥塞**.

> 拥塞控制有哪些控制算法?

- 慢启动
- 拥塞避免
- 拥塞发生
- 拥塞恢复

### 慢启动

TCP 刚建立连接完成后, 首先是有个慢启动的过程, 这个慢启动的意思是一点一点的提高发生数据包的数量.

慢启动算法的规则: **当发送方每收到一个 ACK, 拥塞窗口 cwnd 的大小就加 1**.

假定拥塞窗口 `cwnd` 和发送窗口 `swnd` 相等. 例子:

- 连接建立完成后, 一开始初始化 `cwnd = 1`, 表示可以传一个 `MSS` 大小的数据.

- 当收到一个 ACK 确认应答后, cwnd 增加 1, 于是一次性能够发送 2 个.

- 当这 2 个的 ACK 确认应答后, cwnd 增加 2, 于是一次性能够发送 2 个.

- 当这 4 个的 ACK 确认应答后, 每个确认 cwnd 增加 1, 4 个确认 cwnd 增加 4. 依次类推...

慢启动算法变化过程:

![image](https://cdn.xiaolincoding.com/gh/xiaolincoder/ImageHost2/计算机网络/TCP-可靠特性/27.jpg)

**慢启动算法, 发包的个数是呈现指数性的增长.**

> 慢启动增长的上限是什么?

有一个叫做慢启动门限 `ssthresh` (slow start threshold) 状态变量. 定义了拥塞窗口的上限.


- 当 `cwnd` < `ssthresh` 时, 使用慢启动算法.
- 当 `cwnd` >= `ssthresh` 时, 就会使用 `拥塞避免算法`.






